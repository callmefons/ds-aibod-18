<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>Miyama City Electric Power Demand by Circuit : Linear Regression Model</title>

<script src="site_libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<script src="site_libs/jquery-1.12.4/jquery.min.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="site_libs/datatables-binding-0.4/datatables.js"></script>
<link href="site_libs/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="site_libs/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="site_libs/dt-core-1.10.16/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link rel="stylesheet" href="miyama_linear_model_files/style.css" type="text/css" />

</head>

<body>




<header>
<div class="inner">
<h1 class="title toc-ignore">Miyama City Electric Power Demand by Circuit : Linear Regression Model</h1>
</div>
</header>



<div id="content-wrapper">
  <div class="inner clearfix">
    <section id="main-content">
<style type="text/css">
</style>
<p><nav> <a href="index.html">Home</a> | <a href="miyama_analysis.html">Data Analysis</a> | <a href="miyama_linear_model.html">Linear Regression Model</a> | <a href="miyama_tree_model.html">Random Forest Regression Model</a> | </nav></p>
<div id="the-prediction-model" class="section level3">
<h3>The Prediction model</h3>
<p>This is an R program to apply Multiple linear regression technique on electric power consumption prediction. Our goal is to create a model that predicts daily electric power consumption of different households based on historical electric data, location, day of week, and plan type.</p>
<ul>
<li>This tests the following hypotheses:
<ul>
<li>H<sub>0</sub>: There is no linear association between historical energy consumption of households data, location, day of week, and plan type.</li>
<li>H<sub>1</sub>: Here is a linear association between historical energy consumption of households data, location, day of week, and plan type.</li>
</ul></li>
<li>We selected the data for 86 households and 42 locations for 6 months from 2018-01-01 to 2018-06-30 and divided it into training and test sets. For each machine learning model, we trained the model with the train set for predicting power consumption and used the test set to verify the prediction model.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create new variable that can be used for modeling</span>
df.elec &lt;-<span class="st"> </span>df.day <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(user_id, location, wday, plan_type) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">summarise</span>(<span class="dt">pw_mean =</span> <span class="kw">round</span>(<span class="kw">mean</span>(power), <span class="dv">4</span>),
                   <span class="dt">pw_max =</span> <span class="kw">round</span>(<span class="kw">max</span>(power), <span class="dv">4</span>),
                   <span class="dt">pw_min =</span> <span class="kw">round</span>(<span class="kw">min</span>(power), <span class="dv">4</span>),
                   <span class="dt">pw_sd =</span> <span class="kw">round</span>(<span class="kw">sd</span>(power), <span class="dv">4</span>)) 

<span class="co"># Encoding categorical location data.</span>
df.elec<span class="op">$</span>location &lt;-<span class="st"> </span><span class="kw">as.factor</span>(df.elec<span class="op">$</span>location)
df.elec<span class="op">$</span>location =<span class="st"> </span><span class="kw">factor</span>(df.elec<span class="op">$</span>location,
                       <span class="dt">levels =</span> <span class="kw">as.vector</span>(<span class="kw">unique</span>(df.elec<span class="op">$</span>location)),
                       <span class="dt">labels =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>,
                                  <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span> , <span class="dv">8</span> , <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>,
                                  <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>, <span class="dv">20</span>,
                                  <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">23</span>, <span class="dv">24</span> ,<span class="dv">25</span> ,<span class="dv">26</span> ,<span class="dv">27</span>, <span class="dv">28</span>,
                                  <span class="dv">29</span>, <span class="dv">30</span> ,<span class="dv">31</span> ,<span class="dv">32</span> ,<span class="dv">33</span> ,<span class="dv">34</span> ,<span class="dv">35</span> ,<span class="dv">36</span> , 
                                  <span class="dv">37</span> ,<span class="dv">38</span> ,<span class="dv">39</span> ,<span class="dv">40</span> ,<span class="dv">41</span> ,<span class="dv">42</span>))

<span class="co"># Encoding categorical plan_type data.</span>
df.elec<span class="op">$</span>plan_type =<span class="st"> </span><span class="kw">factor</span>(df.elec<span class="op">$</span>plan_type,
                       <span class="dt">levels =</span> <span class="kw">as.vector</span>(<span class="kw">unique</span>(df.elec<span class="op">$</span>plan_type)),
                       <span class="dt">labels =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span> ,<span class="dv">3</span> ,<span class="dv">4</span> ,<span class="dv">5</span> ,<span class="dv">6</span>))

<span class="co"># Encoding categorical day of week.</span>
df.elec<span class="op">$</span>wday &lt;-<span class="st"> </span><span class="kw">as.factor</span>(df.elec<span class="op">$</span>wday)

<span class="co"># Selecting predictor variables.</span>
df.elec &lt;-<span class="st"> </span>df.elec[,<span class="kw">c</span>(<span class="st">&quot;location&quot;</span>, <span class="st">&quot;wday&quot;</span>, <span class="st">&quot;plan_type&quot;</span>, <span class="st">&quot;pw_max&quot;</span>, <span class="st">&quot;pw_min&quot;</span>, <span class="st">&quot;pw_sd&quot;</span>, <span class="st">&quot;pw_mean&quot;</span>)]

<span class="co"># Removing all the zeros.</span>
df.elec&lt;-df.elec[<span class="op">!</span>(df.elec<span class="op">$</span>pw_mean <span class="op">&lt;</span><span class="dv">1</span>),]

<span class="co"># Splitting the dataset into the Training set and Test set.</span>
<span class="kw">set.seed</span>(<span class="dv">123</span>)
split=<span class="fl">0.80</span> <span class="co"># Define an 80%/20% train/test split of the dataset</span>
trainIndex &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(df.elec<span class="op">$</span>pw_mean, <span class="dt">p=</span>split, <span class="dt">list=</span><span class="ot">FALSE</span>)
training_set &lt;-<span class="st"> </span>df.elec[ trainIndex,]
test_set &lt;-<span class="st"> </span>df.elec[<span class="op">-</span>trainIndex,]</code></pre></div>
<p>Our response variable will continue to be mean of Electric but now we included location, wday, plan_type, max, min and sd of electric power consumption as our list of predictor variables. Our new dataset contain the seven variables to be used in our model. It is now easy for us to plot them using the scatterplotMatrix function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Plot matrix of all variables.</span>
<span class="kw">scatterplotMatrix</span>(df.elec, <span class="dt">spread=</span><span class="ot">FALSE</span>, <span class="dt">lty.smooth=</span><span class="dv">2</span>,
    <span class="dt">main=</span><span class="st">&quot;Scatter Plot Matrix&quot;</span>, <span class="dt">col=</span><span class="st">&quot;#2879d0&quot;</span>)</code></pre></div>
<p><img src="miyama_linear_model_files/figure-html/unnamed-chunk-3-1.png" /><!-- --></p>
<ul>
<li>The matrix plot above allows us to vizualise the relationship among all variables in one single image. For example, we can see how location and day of week are related (see first column, second row top to bottom graph).</li>
</ul>
</div>
<div id="build-linear-regression-model" class="section level3">
<h3>Build Linear Regression Model</h3>
<p>In this section, we’ll train a Linear Regression model for predicting households daily electric power consumption based on historical electric data, location, day of week, and plan type.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Fitting Multiple Linear Regression with variables to the Training set.</span>
regressor =<span class="st"> </span><span class="kw">lm</span>(<span class="dt">formula =</span> pw_mean <span class="op">~</span><span class="st"> </span>. ,
               <span class="dt">data =</span> training_set)

<span class="co"># Capture model summary as an object.</span>
regressor.summary &lt;-<span class="st"> </span><span class="kw">summary</span>(regressor)
f_statistic &lt;-<span class="st"> </span>regressor.summary<span class="op">$</span>fstatistic[<span class="dv">1</span>]  <span class="co"># fstatistic</span>
f &lt;-<span class="st"> </span>regressor.summary<span class="op">$</span>fstatistic  <span class="co"># parameters for model p-value calc</span>
model_p &lt;-<span class="st"> </span><span class="kw">pf</span>(f[<span class="dv">1</span>], f[<span class="dv">2</span>], f[<span class="dv">3</span>], <span class="dt">lower=</span><span class="ot">FALSE</span>)  <span class="co"># model p-Value</span>
r_sq &lt;-<span class="st"> </span>regressor.summary[<span class="dv">8</span>]  <span class="co"># R-Squared</span>
adj_r_sq &lt;-<span class="st"> </span>regressor.summary[<span class="dv">9</span>]  <span class="co"># adj R-Squared</span>
aic &lt;-<span class="st"> </span><span class="kw">AIC</span>(regressor) <span class="co"># AIC </span>
bic &lt;-<span class="st"> </span><span class="kw">BIC</span>(regressor) <span class="co"># BIC</span></code></pre></div>
<div id="anova" class="section level5">
<h5>ANOVA</h5>
<p>Using ANOVA to assess the significance of the category as a whole.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">datatable</span>(<span class="kw">Anova</span>(regressor))</code></pre></div>
<div id="htmlwidget-a42464c4c9e2fad09a4c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a42464c4c9e2fad09a4c">{"x":{"filter":"none","data":[["location","wday","plan_type","pw_max","pw_min","pw_sd","Residuals"],[712396.264588616,20181.8861734696,161619.63206127,1368.06644097436,718689.863440571,754117.331717728,879501.219052929],[41,6,5,1,1,1,409],[8.08024704603618,1.56421830656805,15.031799406541,0.63620056713627,334.216880863133,350.691939920994,null],[1.93211967540626e-32,0.156135913036909,1.47015802463e-13,0.425552811239981,5.2766250284259e-55,5.88151125034347e-57,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Sum Sq<\/th>\n      <th>Df<\/th>\n      <th>F value<\/th>\n      <th>Pr(&gt;F)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<ul>
<li>Taken together, it can be seen that the categorical variable day of week is no longer significantly associated with the variation in daily electric power consumption between individuals. Significant variables are location and plan type.</li>
</ul>
</div>
<div id="performance-measures" class="section level4">
<h4>Performance Measures:</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># F-statistic and model p-Value</span>
<span class="kw">datatable</span>(<span class="kw">data.frame</span>(<span class="dt">F.Statistic=</span>f_statistic, <span class="dt">Model.pValue=</span> model_p))</code></pre></div>
<div id="htmlwidget-ca3cf0474021201a6282" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ca3cf0474021201a6282">{"x":{"filter":"none","data":[["value"],[128.112218952926],[1.54755981187598e-224]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>F.Statistic<\/th>\n      <th>Model.pValue<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<ul>
<li>This is a global null hypothesis to help asses the model. When testing the null hypothesis that there is no linear association between dependent variable and predictor variables. Assuming an alpha of 0.05, since the p-value is less than alpha, we reject the null hypothesis (F<sub>55,409</sub> = 128.1122, p-value &lt; 2.2e-16).</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># R-squared and Adjusted R-squared</span>
<span class="kw">datatable</span>(<span class="kw">data.frame</span>(<span class="dt">R_Sq=</span>r_sq, <span class="dt">Adj_RSq=</span>adj_r_sq))</code></pre></div>
<p><div id="htmlwidget-c882f9b28bf001dad1e9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-c882f9b28bf001dad1e9">{"x":{"filter":"none","data":[["1"],[0.945138757674097],[0.937761328999465]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>r.squared<\/th>\n      <th>adj.r.squared<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script> * Both R2 and adjusted R2 are measures of how well the model explains the given data. The Adjusted R-square takes into account the number of variables and so it’s more useful for the multiple regression analysis. Since, the R-squared is very high in both cases. (Higher the better (&gt; 0.70)) This tells us that about 94% of the proportion of the results variance that can be explained by the model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># AIC and BIC</span>
<span class="kw">datatable</span>(<span class="kw">data.frame</span>(<span class="dt">AIC=</span>aic, <span class="dt">BIC=</span>bic))</code></pre></div>
<div id="htmlwidget-3f1aa141fa2b5dbaf258" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3f1aa141fa2b5dbaf258">{"x":{"filter":"none","data":[["1"],[4942.07169887592],[5178.1678309944]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>AIC<\/th>\n      <th>BIC<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Let’s interpret the contrasts of the variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Contrasts of the variables.</span>
<span class="kw">datatable</span>(regressor.summary<span class="op">$</span>coef, <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">pageLength =</span> <span class="dv">6</span>))</code></pre></div>
<div id="htmlwidget-95d4e45a8a291d24b6ab" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-95d4e45a8a291d24b6ab">{"x":{"filter":"none","data":[["(Intercept)","location2","location3","location4","location5","location6","location7","location8","location9","location10","location11","location12","location13","location14","location15","location16","location17","location18","location19","location20","location21","location22","location23","location24","location25","location26","location27","location28","location29","location30","location31","location32","location33","location34","location35","location36","location37","location38","location39","location40","location41","location42","wday2","wday3","wday4","wday5","wday6","wday7","plan_type2","plan_type3","plan_type4","plan_type5","plan_type6","pw_max","pw_min","pw_sd"],[70.7188843808563,-31.3299418435156,-29.043839955718,34.4572391389365,-29.2604622068766,-4.03499996348441,-0.523598506929068,58.6505912122191,-17.9273489887954,52.0430842801923,46.575252112183,-40.3465936951617,37.7848339225429,-6.89732636469015,15.3279938168946,70.9606471653811,-55.6483083477538,-34.0973924552172,167.630845864849,-29.9230216200633,38.5949396264696,70.418006326186,-38.9493193103065,-22.4456480994575,-4.16301167753151,60.4805863786206,20.6933488668914,53.3659575867151,11.4008046067276,40.1527646263285,33.4766209799017,-30.145103155549,6.37793337254622,-26.0125767677501,74.6465376835996,-33.3865232596802,-92.4090945318848,12.9522248533897,59.8576938532508,24.7447473660267,-0.616302462159774,-30.0491720177246,-15.8141846315704,-19.5298988447489,-21.4561324918187,-12.1811718995329,-9.949459780397,-8.00366638723952,18.8961674327805,-35.6522341052715,-49.098058024101,131.762635156388,35.6533437676592,0.00694254676845039,1.11227411538197,0.751236614428859],[13.0216772848795,34.8143116109976,17.02956228214,18.677158016801,17.5119062623907,13.2399617000451,15.2132666880688,16.6842066037186,23.190994253472,20.7191061396621,13.375951087355,12.1846430321487,29.1073853782119,20.2189637398115,14.7434881947599,24.22471305662,25.8148311461773,22.4109719091183,22.8321045339796,18.6207634749982,17.7438302083162,17.4561352474129,17.3697006570302,17.6135796801683,18.7544756837171,17.9396273768988,16.9421509089762,23.6638051301944,21.567704506024,23.1921408705482,19.4775873328206,17.4499634190118,20.5910578414042,23.4057994266566,20.4608161023482,21.8682335197431,21.257784638128,22.327941487528,22.672457315646,20.5512690551285,21.7264281350607,26.1417337187816,8.32659861612396,8.17865968367526,8.36910908478216,8.26471581349846,8.23575772832807,7.98262926124511,22.2049771736549,7.66693137498318,19.9972976720295,22.7164506594368,26.1278827894899,0.00870405823620149,0.0608411815612179,0.0401156519433595],[5.43085831676795,-0.899915592000924,-1.70549538940165,1.84488663146397,-1.67088960895808,-0.304759186989994,-0.0344172305438979,3.51533594646012,-0.773030633911326,2.51184022753605,3.48201423644656,-3.31126595901978,1.29811844765784,-0.341131546277477,1.03964500221477,2.92926677808426,-2.15567198687621,-1.52145978289072,7.34189201067183,-1.60697071633182,2.17511885389779,4.03399752168067,-2.24237136145131,-1.2743376705378,-0.22197430350697,3.37134016821902,1.22141214407008,2.25517228920303,0.528605378636531,1.73130910382312,1.7187252408563,-1.72751669626458,0.309742870991386,-1.11137313849338,3.64826785550517,-1.52671331360799,-4.34707078394894,0.580090415438637,2.64010614376341,1.2040496039271,-0.0283664879624288,-1.14947127612029,-1.89923705472571,-2.38790946195388,-2.56372957676381,-1.47387667941805,-1.20808067801393,-1.00263536302463,0.850987924238888,-4.65013084916907,-2.45523464366764,5.80031788996276,1.36457071760904,0.797621819621483,18.2815995159924,18.7267706751857],[9.64142105050384e-08,0.36869471158264,0.0888613256893244,0.0657768367319229,0.095508441097975,0.760704582861257,0.972561233842349,0.000488321915895099,0.439950765512774,0.012394595419024,0.000551297468351768,0.00101122550510979,0.194978173656789,0.733179728343011,0.299119056563645,0.00358780477161064,0.0316919879986925,0.128917211844965,1.14738913960791e-12,0.10883248801894,0.0301934206417624,6.54407736041383e-05,0.0254725257444231,0.203267338851809,0.824444679672926,0.000819205025526992,0.22263357648699,0.0246505016047807,0.597365948081293,0.084150743275691,0.0864211187825213,0.0848298095271112,0.756914248282794,0.267060648482362,0.000298160030112103,0.127605237202434,1.74330501953793e-05,0.562173075667065,0.00860511359926889,0.229266758046386,0.977383687952924,0.251033420335403,0.0582366523245939,0.0173975527548293,0.0107118787960878,0.141284028530015,0.227714284989658,0.316629636147989,0.395273997395121,4.48424299284151e-06,0.0144946006283152,1.32644822714326e-08,0.173138295345957,0.425552811239976,5.2766250284259e-55,5.88151125034322e-57]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Estimate<\/th>\n      <th>Std. Error<\/th>\n      <th>t value<\/th>\n      <th>Pr(&gt;|t|)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":6,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[6,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<ul>
<li>When there’s more than one predictor variable, the regression coefficients indicate the increase in the dependent variable for a unit change in a predictor variable, holding all other predictor variables constant. For example, the regression coefficient for Location 4 is 66.92826, suggesting that an increase of 1 percent in Location 4 is associated with a 67 percent increase in the daily electric power consumption, controlling for the other predictor variables. The coefficient is significantly different from zero at the p &lt; .0001 level. On the other hand, the coefficient for Location 5 isn’t significantly different from zero (p = 0.27) suggesting that Location 5 and the daily electric power consumption aren’t linearly related when controlling for the other predictor variables.</li>
</ul>
</div>
<div id="regression-diagnostics" class="section level4">
<h4>Regression diagnostics</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))
<span class="kw">plot</span>(regressor, <span class="dt">col=</span><span class="st">&quot;#2879d0&quot;</span>)</code></pre></div>
<p><img src="miyama_linear_model_files/figure-html/unnamed-chunk-10-1.png" /><!-- --></p>
<ul>
<li><strong>Residuals versus Fitted</strong> – the Residuals versus Fitted graph (upper left)
<ul>
<li>A horizontal trend line in the plot indicates absence of nonlinear patterns between response and predictors, which is what is expected in a linear model.</li>
<li>A model will exhibit heteroscedasticity when the residuals are not equally spread along the fitted values and there are some points on the plot well-separated from the rest, you see clear evidence of a curved relationship, which suggests that you may want to add a quadratic term to the regression.</li>
</ul></li>
<li><strong>Normality</strong> – the Normal Q-Q plot (upper right) is a probability plot of the standardized residuals against the values that would be expected under normality. Though most of the points seem to fall on the straight 45-degree line which indicates that our residuals come from a normal distribution, there are some points that stray from the line in the lower and upper quantiles of the plot. It is possible that these points do not come from a normal distribution, but most of our points seem to come from a normal distribution so there is not a lot to worry about here.</li>
<li><strong>Scale-Location</strong> – the Scale-Location graph (bottom left) should be a random band around a horizontal line. The plot shows most the residuals appear randomly spread, not a lot the residuals spread wider. So we seem to meet the constant variance assumption (homoscedasticity).</li>
<li><strong>Residuals vs Leverage</strong> – the Residual versus Leverage graph (bottom right)
<ul>
<li>It doesn’t have a large positive or negative residual (an outlier), so the observations that are predicted well by the fitted regression model.</li>
<li>An observation without a high leverage value has an unusual combination of predictor values. That is, it’s no an outlier in the predictor space. The dependent variable value can be used to calculate an observation’s leverage.</li>
<li>We can barely see Cook’s distance lines (a red dashed line) because almost all cases are well inside of the Cook’s distance lines, the observations that have a proportionate impact on the determination of the model parameters.</li>
</ul></li>
</ul>
</div>
<div id="predicting-the-test-set-results" class="section level4">
<h4>Predicting the Test set results</h4>
<p>Once the model is created, it can then be used to make predictions on new examples that were not seen in training (the test data).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y_pred =<span class="st"> </span><span class="kw">predict</span>(regressor, <span class="dt">newdata =</span> test_set)</code></pre></div>
</div>
<div id="calculate-prediction-accuracy-and-error-rates" class="section level4">
<h4>Calculate prediction accuracy and error rates</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Calculate accuracy measures on training set</span>
actual_fitted &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">actual=</span>training_set<span class="op">$</span>pw_mean, <span class="dt">fitted=</span>regressor<span class="op">$</span>fitted.values)
min_vals &lt;-<span class="st"> </span><span class="kw">apply</span>(actual_fitted, <span class="dv">1</span>, min)
max_vals &lt;-<span class="st"> </span><span class="kw">apply</span>(actual_fitted, <span class="dv">1</span>, max)
training_min_max &lt;-<span class="st"> </span>min_vals<span class="op">/</span>max_vals
training_min_max_accuracy &lt;-<span class="st"> </span><span class="kw">mean</span>(training_min_max)

<span class="co"># Calculate accuracy measures on test set</span>
actuals_preds &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">cbind</span>(<span class="dt">actual=</span>test_set<span class="op">$</span>pw_mean, <span class="dt">predicted=</span>y_pred))  
min_vals &lt;-<span class="st"> </span><span class="kw">apply</span>(actuals_preds, <span class="dv">1</span>, min)
max_vals &lt;-<span class="st"> </span><span class="kw">apply</span>(actuals_preds, <span class="dv">1</span>, max)
predicted_min_max &lt;-<span class="st"> </span>min_vals<span class="op">/</span>max_vals
predicted_min_max_accuracy &lt;-<span class="st"> </span><span class="kw">mean</span>(min_vals<span class="op">/</span>max_vals)

<span class="co"># Display</span>
<span class="kw">datatable</span>(<span class="kw">data.frame</span>(<span class="dt">training_min_max_accuracy=</span>training_min_max_accuracy, 
                     <span class="dt">predicted_min_max_accuracy=</span>predicted_min_max_accuracy))</code></pre></div>
<div id="htmlwidget-b44bb72439c8f6980a4c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b44bb72439c8f6980a4c">{"x":{"filter":"none","data":[["1"],[0.854557038897086],[0.886635317031238]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>training_min_max_accuracy<\/th>\n      <th>predicted_min_max_accuracy<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Correlation Accuracy</span>
correlation_accuracy &lt;-<span class="st"> </span><span class="kw">cor</span>(actuals_preds)
correlation_accuracy</code></pre></div>
<pre><code>##              actual predicted
## actual    1.0000000 0.9626168
## predicted 0.9626168 1.0000000</code></pre>
<ul>
<li>By calculating accuracy measures we can find out the prediction accuracy of the model, 96% is a higher correlation accuracy implies that the actual and predicted values have similar directional movement.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Calculate some standard regression evaluation statistics</span>
regr.eval &lt;-<span class="st"> </span>DMwR<span class="op">::</span><span class="kw">regr.eval</span>(actuals_preds<span class="op">$</span>actual, actuals_preds<span class="op">$</span>predicted)
<span class="kw">datatable</span>(<span class="kw">as.data.frame</span>(regr.eval))</code></pre></div>
<div id="htmlwidget-044e2be6e04d06b3e629" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-044e2be6e04d06b3e629">{"x":{"filter":"none","data":[["mae","mse","rmse","mape"],[35.8827490196141,2289.68110087512,47.8506123354249,0.194850070969389]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>regr.eval<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="display-actual-and-predict-observations" class="section level4">
<h4>Display actual and predict observations</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Actual and predict observations</span>
<span class="kw">datatable</span>(actuals_preds, <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">pageLength =</span> <span class="dv">6</span>))</code></pre></div>
<div id="htmlwidget-b0b878fb26ebfdf73927" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b0b878fb26ebfdf73927">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116"],[262.9821,267.2225,274.1225,280.6467,274.1083,282.9442,129.3731,138.4494,583.9123,525.0634,522.7587,522.472,484.4417,634.8939,302.4967,303.9125,483.3994,453.4675,215.4088,367.7858,463.3602,478.5283,194.2589,176.915,576.2442,566.2298,458.1089,469.0433,41.7117,36.974,36.3242,988.7633,413.4583,384.0435,329.0226,668.4621,703.1725,683.8273,300.2524,298.2125,294.1342,216.3481,267.2326,293.1208,157.1143,153.9801,156.8233,280.1098,625.5867,712.0884,361.6649,336.5667,213.4091,187.1632,274.1017,503.5226,495.705,195.316,345.6083,262.8025,126.9842,231.9173,184.8464,183.6275,324.8125,287.755,282.6542,335.6342,353.5817,350.6293,413.3762,143.9628,208.9019,230.5142,242.5588,254.6589,262.9608,207.4375,216.8125,466.2908,497.1508,106.1075,219.5804,203.9858,215.2583,226.325,223.0009,216.6233,218.0642,272.8357,283.4422,276.4253,416.6496,177.6792,365.0158,131.0025,176.1357,173.9006,380.2308,560.7535,709.8608,706.0078,721.7108,316.9006,309.1158,314.625,6.3542,164.6092,718.8608,312.638,298.5925,333.1905,259.9239,263.6908,362.7369,300.0805],[310.671648646443,261.190915369065,260.553254539798,266.161901492853,271.158844842339,274.012315959282,111.590962715805,104.499020316813,486.145852685066,459.014895448885,450.207059418025,529.274152262418,480.988110047719,596.982377678691,316.852780103131,324.631582712721,477.937319686721,482.092822221076,170.734475256536,387.835092494339,412.324719434385,425.084057771318,209.304866815743,185.997466276476,616.877418919751,533.633605123017,408.888229609112,415.5466949804,33.2072007346316,22.0878102755495,31.3977168692556,1143.08068467944,412.693508019203,398.033444292147,351.078199925415,591.058489813261,625.761498104805,613.853025926093,318.318364972076,307.1201361342,322.436527612113,202.0898064412,317.379926193619,363.795982453671,147.424344511453,116.893298304674,141.706399490375,319.513981264692,519.817921836702,711.17835931898,461.797208179432,414.904759089165,294.134584129622,256.064612059878,294.132168536125,540.508482921775,526.456248917066,164.83599931018,345.27945455937,259.742371681636,125.517841746014,194.08905359673,139.159762504772,160.679293925521,268.728345505304,262.796768332039,274.696866021204,336.576421087922,345.064301428968,325.814602206609,376.639920263391,128.356899495681,255.342686429558,291.130790214797,220.454300233565,258.92959670311,314.758534062976,195.227434696736,230.755309956709,406.795388776808,553.314233361586,101.286193044545,346.155934074054,314.601016377465,328.031428750724,214.159476290267,182.757649446741,160.075664582762,179.824102368785,329.509404871146,297.448497101811,304.977657331962,405.833194141128,177.768618823954,307.561952373891,154.995250421075,188.706030600783,166.093725078932,286.191285955027,552.926289185852,775.397055708977,763.266787697684,769.05687732083,321.419782848766,306.72406484866,314.356504291265,63.2847441345699,162.358631214631,596.559362864117,368.140812298018,323.868774194292,298.080313417433,272.77518709507,283.269909269938,393.760462071937,337.269847063561]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>actual<\/th>\n      <th>predicted<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":6,"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[6,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="repeated-k-fold-cv" class="section level4">
<h4>Repeated k-fold CV</h4>
<p>Let’s ensure the model equation we have will perform well, when it is ‘built’ on a different subset of training data and predicted on the remaining data.</p>
<p>In below result we will define the training control, we use repeatedcv method to divide our dataset into 10 folds cross-validation and repeat only 3 repeat times in order to slows down our process.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Define the training control</span>
fitControl &lt;-<span class="st"> </span><span class="kw">trainControl</span>(
    <span class="dt">method=</span><span class="st">&#39;repeatedcv&#39;</span>,  <span class="co">#repeat k-fold cross validation</span>
    <span class="dt">number=</span><span class="dv">10</span>, <span class="co"># number of folds</span>
    <span class="dt">repeats=</span><span class="dv">3</span>, <span class="co"># number of repeats</span>
    <span class="dt">savePredictions =</span> <span class="st">&#39;final&#39;</span>,  <span class="co"># saves predictions for optimal tuning parameter</span>
    <span class="dt">classProbs =</span> T  <span class="co"># should class probabilities be returned</span>
) 

<span class="co"># Fitting Multiple Linear Regression with variables to the Training set.</span>
regressor.cv &lt;-<span class="st"> </span><span class="kw">train</span>(pw_mean <span class="op">~</span><span class="st"> </span>., 
         <span class="dt">data =</span> training_set, 
         <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, 
         <span class="dt">trControl =</span> fitControl)
model_lm &lt;-<span class="st"> </span>regressor.cv
<span class="kw">save</span>(model_lm, <span class="dt">file =</span> <span class="st">&quot;model_lm.Rdata&quot;</span>) <span class="co"># Save model</span></code></pre></div>
</div>
<div id="model-summary" class="section level4">
<h4>Model summary</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;model_lm.Rdata&quot;</span>)
model_lm</code></pre></div>
<pre><code>## Linear Regression 
## 
## 465 samples
##   6 predictor
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold, repeated 3 times) 
## Summary of sample sizes: 417, 420, 417, 417, 419, 419, ... 
## Resampling results:
## 
##   RMSE      Rsquared   MAE     
##   48.53071  0.9301044  36.64231
## 
## Tuning parameter &#39;intercept&#39; was held constant at a value of TRUE</code></pre>
<hr />
<p>Looking for other parts of this series?</p>
<ul>
<li><strong><a href="miyama_analysis.html">Data analysis</a> </strong></li>
<li><strong><a href="miyama_linear_model.html">Linear regression model</a> </strong></li>
<li><strong><a href="miyama_tree_model.html">Random Forest Regression Model</a> </strong></li>
</ul>
</div>
</div>
    </section>
  </div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
